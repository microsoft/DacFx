trigger: none

pr:
  branches:
    include:
    - main

variables:
  solution: '**/*.sln'
  configuration: 'Debug'

stages:
- stage: Build
  displayName: 'PR Validation'

  jobs:
  - job: BuildTest
    displayName: 'Build and Test on'

    # Verifies cross-platform build and test on different .NET SDK versions
    strategy:
      matrix:
        linux_net31:
          imageName: 'ubuntu-latest'
          dotnetVersion: '3.1.x'
        linux_net5:
          imageName: 'ubuntu-latest'
          dotnetVersion: '5.x'
        linux_net6:
          imageName: 'ubuntu-latest'
          dotnetVersion: '6.x'
        linux_net7:
          imageName: 'ubuntu-latest'
          dotnetVersion: '7.x'
        mac_net31:
          imageName: 'macos-latest'
          dotnetVersion: '3.1.x'
        mac_net5:
          imageName: 'macos-latest'
          dotnetVersion: '5.x'
        mac_net6:
          imageName: 'macos-latest'
          dotnetVersion: '6.x'
        mac_net7:
          imageName: 'macos-latest'
          dotnetVersion: '7.x'
        windows_net31:
          imageName: 'windows-latest'
          dotnetVersion: '3.1.x'
        windows_net5:
          imageName: 'windows-latest'
          dotnetVersion: '5.x'
        windows_net6:
          imageName: 'windows-latest'
          dotnetVersion: '6.x'
        windows_net7:
          imageName: 'windows-latest'
          dotnetVersion: '7.x'

    pool:
      vmImage: '$(imageName)'

    workspace:
      clean: all

    steps:
    - template: 'template-steps-build-test.yml'
      parameters:
        solution: '$(solution)'
        configuration: '$(configuration)'
        nugetVersion: '1.0.0'
        runCodeSign: 'false'
        dacFxPackageVersion: ''
        dotnetVersion: '$(dotnetVersion)'